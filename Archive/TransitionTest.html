<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<!--<link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400,700,300italic,400italic|Ubuntu+Condensed' rel='stylesheet' type='text/css'>-->
<style>

body{
  max-width:1100px;
  width:100%;
  position:relative;
  margin: 0px auto 0px auto;
  font-size:16px;
}

h1,h2,h3,p,a{font-family:ubuntu,arial,sans;margin:1.25em 0px 0.25em 6px;line-height:1.5em;}
a{margin-left:0px;}

.box{
  position:relative;
  width:500px;
  height:50px;
  padding:5px;
  background-color:#d1d1d1;
  margin:20px;
}

div#button{
  width:490px;
  height:30px;
  padding:10px;
  background-color:#0000ff;
  margin:20px;
  color:#ffffff;
}

p{pointer-events:none;}

</style>
<body>


<div id="main">
  <div id="button">
    CLICK TO ADD NEW BOXES
  </div>
</div>

<script src="d3v3dot4.js"></script>
<script>
  
  var dat = [0,1,2,3,4];

  var svg = d3.select("#main");
  svg.selectAll("div.box").data(dat).enter().append("div").attr("class","box").text(function(d,i){return d});

  var button = d3.select("#button")
  button.on("mousedown",function(){
    dat.push(dat[dat.length-1] + 1);
    dat.shift();

    var update = svg.selectAll("div.box").data(dat,function(d,i){return d});
    update.style("border-left","0px solid #0000ff").text(function(d,i){return d + ": update"});


    update.enter().append("div").attr("class","box").text(function(d,i){return d + ": enter"}).style("border-left","0px solid #00ff00");
    update.exit()
    .style("border-left","40px solid #000000")
    .text(function(d,i){
      return d + ": exit";
    }).transition().delay(5000).duration(1000)
    .style("width",function(d,i){
      console.log(this.__transition__);
      return "0px";
    })
    .style("border-left-width","0px")
    .text("")
    .remove();

    update
    .transition().duration(4500).style("border-left-width","40px")
    .text(function(d,i){
        try{
          var c = d + " " + JSON.stringify(this.__transition__)        }
        catch(e){
          var c = d;
        }
        finally{
          return c;
        }
      })
    .each("end",function(d,i){
      d3.select(this).transition().duration(700).style("border-left-width","0px")
    })


  })

</script>

</body>
</html>